using System;
using System.Collections.Generic;
using System.Management.Automation;

namespace BlackDuck.Hub {
    public class VulnerabilityId {
        private VulnerabilityId () { }

        public string Source { get; private set; }
        public string Id { get; private set; }
        public String Vulnerability { get; private set; }

        public override string ToString () {
            return $"{Source}:{Id}";
        }

        /* Parses a dynamic PowerShell object representing a vulnerability ID */
        public static VulnerabilityId Parse (PSObject input) {
            if (input is null) return null;
            var props = input.Properties;
            return new VulnerabilityId {
                Source = (string) props["source"]?.Value,
                Id = (string) props["vulnerabilityId"]?.Value,
                Vulnerability = (string) props["vulnerability"]?.Value
            };
        }

        /* Parses an array of PowerShell vulnerability ID objects */
        public static IList<VulnerabilityId> Parse (object[] input) {
            var result = new List<VulnerabilityId> (input.Length);
            foreach (var psObject in input) {
                result.Add (Parse (psObject as PSObject));
            }
            return result;
        }
    }
}